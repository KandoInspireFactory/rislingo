# 作業ログ (2025年12月15日)

## 1. 実施内容まとめ

### 環境構築と修正
- **フォルダー構成の整理**: `__MACOSX` の削除、および二重になっていた `v4_rislingo-main` フォルダをフラットな構成に修正しました。
- **ローカル環境の復旧**:
    - バックエンド (`backend/`) の仮想環境 (`venv`) を再構築。
    - 依存パッケージ (`requirements.txt`) を再インストール。
    - PostgreSQL接続設定 (`.env`) の修正 (ユーザー名 `postgres` とパスワードの明記)。
- **起動確認**:
    - ローカルPostgreSQLを使用してバックエンド、フロントエンド共に起動することを確認しました。

### データベース移行 (Local → Neon)
- **Neonへの切り替え**: ローカル開発環境の接続先を、クラウドDB (Neon) に変更しました。
- **マイグレーション**: `alembic upgrade head` を実行し、Neon上にテーブルを作成しました。
- **動作確認**: アプリがNeonに接続して正常に動作することを確認しました。

### デプロイ準備 (Azure & GitHub)
- **GitHubリポジトリ作成**: `https://github.com/KandoInspireFactory/rislingo.git` を作成。
- **Git初期化とプッシュ**: プロジェクトルート (`v4_rislingo-main`) でGitを初期化し、全コードを `main` ブランチにプッシュしました（モノレポ構成）。
- **デプロイ方針の決定**:
    - バックエンド: Azure Web App (Python/Linux)
    - フロントエンド: Azure Static Web Apps (Next.js)
    - **手順**: バックエンドを先に作成・デプロイし、そのURLをフロントエンドの環境変数に設定する順序で進めることを確認。

## 2. 現在のプロジェクト構成

**GitHubリポジトリ**: [KandoInspireFactory/rislingo](https://github.com/KandoInspireFactory/rislingo)

**フォルダー構造 (ルート: `C:\Users\s3792\projects\v4_rislingo-main`)**:
```
.
├── backend/               # FastAPI アプリケーション (Azure Web Appへデプロイ予定)
│   ├── .env               # 環境変数 (DATABASE_URL=Neon..., OPENAI_API_KEY=...)
│   ├── main.py            # エントリーポイント
│   ├── alembic/           # DBマイグレーションスクリプト
│   └── requirements.txt   # 依存ライブラリ
│
├── frontend/              # Next.js アプリケーション (Azure Static Web Appsへデプロイ予定)
│   ├── .env.local         # 環境変数 (NEXT_PUBLIC_API_URL=...)
│   └── package.json
│
├── .gitignore             # Git除外設定
├── README.md
└── 実行手順.md             # ローカル起動手順書
```

**仕様・設定**:
- **DB**: Neon (PostgreSQL互換)
- **Backend Port**: 8000
- **Frontend Port**: 3000

## 3. 次回のアクションアイテム

**目標**: Azureへのデプロイ完了

1.  **Azure Web App (Backend) の作成**:
    - Azure Portal で Python 3.12 (Linux) の Web App を作成。
    - 環境変数 (`DATABASE_URL`, `OPENAI_API_KEY`) を設定。
    - スタートアップコマンドを設定 (`gunicorn ...`)。
2.  **GitHub Actions の修正**:
    - Azureが自動生成したワークフローファイルを修正し、`/backend` フォルダを対象にビルド・デプロイするように設定を変更する。
3.  **デプロイ確認**:
    - バックエンドのURL (例: `https://rislingo-api.azurewebsites.net/docs`) にアクセスして稼働を確認。
4.  **Azure Static Web Apps (Frontend) の作成**:
    - Azure Portal で作成し、GitHubリポジトリと連携。
    - ビルド設定で `App location` を `/frontend` に指定。
    - 環境変数 `NEXT_PUBLIC_API_URL` にバックエンドのURLを設定。
5.  **最終動作確認**:
    - 公開されたフロントエンドのURLからアプリが動き、バックエンド(Neon)と通信できるか確認。
