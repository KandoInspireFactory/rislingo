# アプリケーションの実行手順

本ドキュメントでは、アプリケーションをローカル環境で開発・テストする方法と、デプロイ済みの環境で利用する方法を説明します。

---

## 1. ローカル環境での実行

PCを再起動した後、このアプリケーションをローカル環境で立ち上げるための手順です。
PostgreSQLサーバーがWindowsサービスとして実行中であることを前提とします。

### ステップ 1: OpenAI APIキーとデータベース接続情報の確認 (初回のみ / 変更時)

`C:\Users\s3792\projects\v4_rislingo-main\backend\.env` ファイルを開き、以下の環境変数が正しく設定されていることを確認してください。

```env
# PostgreSQLのユーザー名 (通常は postgres) と、インストール時に設定したパスワードを設定
DATABASE_URL=postgresql://postgres:あなたのPostgreSQLパスワード@localhost:5432/toefl_speaking_dev

# 取得したOpenAI APIキーを設定 (sk- から始まる文字列)
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# またはAzure OpenAIを使用する場合
# AZURE_OPENAI_API_KEY=...
# AZURE_OPENAI_ENDPOINT=...
# AZURE_API_VERSION=...
# AZURE_GPT_DEPLOYMENT=...
# AZURE_WHISPER_DEPLOYMENT=...
# AZURE_TTS_DEPLOYMENT=...
```

### ステップ 2: バックエンドサーバーの起動

1.  新しいPowerShellウィンドウを開きます。
2.  以下のコマンドを順番に実行してください。

    ```powershell
    # バックエンドフォルダへ移動
    cd C:\Users\s3792\projects\v4_rislingo-main\backend

    # 仮想環境を有効化
    .\venv\Scripts\Activate.ps1

    # (オプション) データベースマイグレーションの確認・実行
    # データベースのスキーマ変更があった場合や、データベースが初期状態の場合に実行します。
    # createdb -U postgres toefl_speaking_dev # データベースが未作成の場合のみ実行
    # alembic upgrade head 

    # バックエンドサーバーを起動
    uvicorn main:app --reload --host 0.0.0.0 --port 8000
    ```
    *   バックエンドサーバーが起動すると `INFO: Application startup complete.` のようなメッセージが表示され、待機状態になります。このPowerShellウィンドウは**閉めずに**開いたままにしてください。

### ステップ 3: フロントエンドサーバーの起動

1.  **別の** PowerShellウィンドウを開きます。
2.  以下のコマンドを順番に実行してください。

    ```powershell
    # フロントエンドフォルダへ移動
    cd C:\Users\s3792\projects\v4_rislingo-main\frontend

    # 依存関係のインストール (初回起動時や変更があった場合のみ)
    # npm install

    # フロントエンドサーバーを起動
    npm run dev
    ```
    *   フロントエンドサーバーが起動すると `✓ Ready in ...ms` のようなメッセージが表示され、待機状態になります。このPowerShellウィンドウも**閉めずに**開いたままにしてください。

### ステップ 4: ローカルアプリケーションへのアクセス

1.  お使いのウェブブラウザ（Chrome, Edge, Firefoxなど）を開きます。
2.  アドレスバーに以下のURLを入力して、`Enter` キーを押してください。
    `http://localhost:3000`

これで、アプリケーションの画面が表示されます。

### アプリケーションの停止 (ローカル環境)

作業が完了したら、バックエンドとフロントエンドを起動している2つのPowerShellウィンドウでそれぞれ `Ctrl + C` を押してサーバープロセスを停止し、ウィンドウを閉じてください。

---

## 2. デプロイ済み環境での実行

本アプリケーションはAzure Web Appsにデプロイされており、インターネット経由でアクセス可能です。

### ステップ 1: アプリケーションへのアクセス

以下のURLをクリックして、アプリケーションを直接開くことができます。

**フロントエンド (Next.js)**:
[https://tech0-gen-11-step3-2-node-24.azurewebsites.net](https://tech0-gen-11-step3-2-node-24.azurewebsites.net)

このフロントエンドアプリケーションは、バックエンドAPI (`https://tech0-gen-11-step3-2-py-24.azurewebsites.net`) と通信し、各種機能を提供します。

### ステップ 2: ログアウト時の挙動について (重要)

最近の修正により、セッション情報はデータベースに保存されるようになりました。これにより、デプロイやサーバーの再起動があってもログイン状態は維持されるはずです。もしセッションが失われる場合は、ネットワークの問題や、稀に発生する環境側の問題が考えられます。

---